<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MultiHazard Risk Visualization</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<!-- Le styles -->
<link href="./css/bootstrap.css" rel="stylesheet">
<style type="text/css">
  body {		
    padding-top: 20px;
    padding-bottom: 40px;
    background-color:#ffffff;
    color: #000000;
  }

  /* Custom container */
  .container-narrow {
    margin: 0 auto;
    max-width: 1220px;	
  background-color:#ffffff;
  }
  .container-narrow > hr {
    margin: 30px 0;		
  }

 </style>
<link href="./css/bootstrap-responsive.css" rel="stylesheet">

<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
<![endif]-->

<!-- Fav and touch icons -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
                <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
                               <link rel="shortcut icon" href="ico/favicon.png">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


<!-- Load d3.js and the geo projection plugin -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<!-- Load Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
<!-- <script src="./leaflet.polygon.gradient.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/polygon-clipping@0.14.3/dist/polygon-clipping.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vsup@latest"></script>
<script src="./colour.js"></script>
<script src="https://unpkg.com/d3-scale-cluster@1.3.1/dist/d3-scale-cluster.min.js"></script>
</head>
<body>
<!-- Create an element where the map will take place -->


<style>
    #mapid { height: 700px; width: 700px;}

    .legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}

.legend j {
    width: 2px;
    height: 18px;
    float: left;
    opacity: 0.7;
}
</style>

<div class="container" >
    <div class="container-narrow">   
        <div class="masthead">
            <h3>Multihazard Risk Visualization</h3>
          </div>
    
          <hr> 
        <div class="span8">
            <div id="mapid"></div>
        </div>
        <div class="span3">
            <div >
                <h2> Color Schemes</h2>   
	
                <div style="outline: 1px solid black;"> 
                <input type="radio" name="color_scale" value="cb" onclick="displayColor()">Color Brewer Scale <br>
                <input type="radio" name="color_scale" value="cp"  onclick="displayColor()">Chloropleth Color Scale <br> 
                <div class="slidercontainer" style="outline: 1px  black;">
                <input type="range" min="1" max="100" value="50" class="slider" id="divide_data">
                <p>Min: <span id="dd"></span></p>
                </div>
            </div> <br> 
		    
                <input type="radio" name="color_scale" value="cl"  onclick="displayColor()">Cluster based Chloropleth Scale <br> <br>

              <input type="radio" name="color_scale" value="gs"  onclick="displayColor()">Gradient Color Scale <br> <br> 
               
                <div class="slidercontainer" style="outline: 1px solid black;">
                    <input type="radio" name="color_scale" value="hs"  onclick="displayColor()">Hue Scale <br> 
                    <input type="range" min="1" max="100" value="1" class="slider" id="myRange1">
                    <p>Min: <span id="demo1"></span></p>
                    <input type="range" min="1" max="100" value="100" class="slider" id="myRange2">
                    <p>Max: <span id="demo2"></span></p>
                </div>
		
            </div> 
            <br>
            <br>
            <div style="outline: 1px  black;">
                <h2> Natural Hazards</h2>
                <input type="checkbox" class="checks" value=1>Fire<br>
                <input type="checkbox" class="checks" value=2>Earthquake<br> <br>                   
                <button type="button" class="btn btn-primary" onclick="displayMap()">  Submit  </button> <br>  
            </div>              
        </div>
    </div>
</div>
   
 





<script>
    

var slider_divide = document.getElementById("divide_data");
var output_divide = document.getElementById("dd");

var div_data=0.5;
slider_divide.oninput = function() {
    div_data = slider_divide.value/100;
    output_divide.innerHTML = slider_divide.value/100;
}  

var slider_min = document.getElementById("myRange1");
var output_min = document.getElementById("demo1");

var min_hue=0;
slider_min.oninput = function() {
    min_hue = slider_min.value/100;
    output_min.innerHTML = slider_min.value/100;
}

var slider_max = document.getElementById("myRange2");
var output_max = document.getElementById("demo2");

var max_hue=10;
slider_max.oninput = function() {
    max_hue = slider_max.value/100;
    output_max.innerHTML = slider_max.value/100;
}




var chosen_scale="";
var data_types=3;


function displayColor() { 
            var ele = document.getElementsByName('color_scale');   
                 
            for(i = 0; i < ele.length; i++) { 
                
                if(ele[i].checked) 
                {
                    chosen_scale=ele[i].value; 
                }
                    
            } 
            //reloadDIV ();
         //   draw_map(data_types,chosen_scale);
           
} 


function displayMap() { 
            var ele = document.getElementsByClassName('checks');            
            var map_type=0;
            for(i = 0; i < ele.length; i++) {                 
                if(ele[i].checked) 
                {
                    map_type+=parseInt(ele[i].value);

                }
                     
            }             
            data_types=map_type;
            draw_map(data_types,chosen_scale);
           
} 

var color_brewer =['#feebe2','#fcc5c0','#fa9fb5','#f768a1','#c51b8a','#7a0177'];
var cp_colors=["#FEB24C","#FD8D3C", "#FC4E2A","#E31A1C","#BD0026","#800026"];
var orangeRedTruncate=["#fdb07a","#fa8e5d","#e04530","#c81d13","#a70403","#7f0000"];   

//var cp_colors=[rgbToHex(158,202,225),rgbToHex(107,174,214), rgbToHex(66,146,198),rgbToHex(33,113,181),rgbToHex(8,81,156),rgbToHex(8,48,107)];





function interpolateHue(t)
{
    var c1_h =(1-t)*240.0;
        var c1_s =1.0;
        var c1_v=1.0;
        var sat_r=0,sat_g=0,sat_b=0;

        while ( c1_h<0.0 ) c1_h += 360.0;
	    while ( c1_h>360.0 ) c1_h -= 360.0;

        if ( c1_h<120.0 ){
            sat_r = (120.0-c1_h) / 60.0;
		    sat_g = c1_h / 60.0;
		    sat_b = 0.0;
	    }
	    else if ( c1_h<240.0 ) {	
            sat_r = 0.0;
		    sat_g = (240.0-c1_h) / 60.0;
		    sat_b = (c1_h-120.0) / 60.0;
	    } 
	    else{
            sat_r = (c1_h-240.0) / 60.0;
		    sat_g = 0.0;
		    sat_b = (360.0-c1_h) / 60.0;
	    }
	    if ( sat_r>1 ) sat_r=1;
	    if ( sat_g>1 ) sat_g=1;
	    if ( sat_b>1 ) sat_b=1;

	    var c2_r = ( 1 - c1_s + c1_s*sat_r ) * c1_v;
	    var c2_g = ( 1 - c1_s + c1_s*sat_g ) * c1_v;
        var c2_b = ( 1 - c1_s + c1_s*sat_b ) * c1_v;
        c2_r = Math.ceil(c2_r*255);
        c2_g = Math.ceil(c2_g*255);
        c2_b = Math.ceil(c2_b*255);

        return rgbToHex(c2_r,c2_g,c2_b);
}


function get_region_color(averages,max,min,num,val){      

    if(chosen_scale==="cb")
    {
          var len=color_brewer.length;
          var new_id=0; 
          if(div_data!=0.5)
          {
                var fc=0; //number of data in first half
                var lc=0; //number of data in second half
                var new_val=((val-min)/(max-min)); 
                for(i=0;i<averages.length;i++)
                {
                    var scaled_val=((averages[i]-min)/(max-min)); 
                    if(scaled_val<div_data)
                    {
                            fc++; 
                    }
                    else
                    {
                            lc++;
                    }
                }
                var fh_ids= Math.ceil(color_brewer.length*(fc/averages.length));
                var lh_ids= color_brewer.length-fh_ids;

              if(new_val<div_data)
              {
                 new_id=Math.ceil (fh_ids*((val-min)/(max-min))); 
              }
              else
              {
                new_id=fh_ids+Math.ceil (fh_ids*((val-min)/(max-min))); 
              }


              if(new_id==0)
              {
                    new_id=1;
              } 
              else if(new_id>=color_brewer.length)
              {
                  new_id=color_brewer.length-1
              }
          }
          else
          {
            var len=cp_colors.length;
            var new_id = Math.ceil (len*((val-min)/(max-min))); 
            if(new_id==0)
            {
                new_id=1;
            } 
          }

          return color_brewer[new_id-1];
    }
    else if(chosen_scale==="cp")
    {      

        var len=cp_colors.length;
          var new_id=0; 
          if(div_data!=0.5)
          {
                var fc=0; //number of data in first half
                var lc=0; //number of data in second half
                var new_val=((val-min)/(max-min)); 
                for(i=0;i<averages.length;i++)
                {
                    var scaled_val=((averages[i]-min)/(max-min)); 
                    if(scaled_val<div_data)
                    {
                            fc++; 
                    }
                    else
                    {
                            lc++;
                    }
                }
                var fh_ids= Math.ceil(cp_colors.length*(fc/averages.length));
                var lh_ids= cp_colors.length-fh_ids;

              if(new_val<div_data)
              {
                 new_id=Math.ceil (fh_ids*((val-min)/(max-min))); 
              }
              else
              {
                new_id=fh_ids+Math.ceil (fh_ids*((val-min)/(max-min))); 
              }


              if(new_id==0)
              {
                    new_id=1;
              } 
              else if(new_id>=cp_colors.length)
              {
                  new_id=cp_colors.length-1
              }
          }
          else
          {
            var len=cp_colors.length;
            var new_id = Math.ceil (len*((val-min)/(max-min))); 
            if(new_id==0)
            {
                new_id=1;
            } 
          }

          return cp_colors[new_id-1];

        // var len=cp_colors.length;
        // var new_val = Math.ceil (len*((val-min)/(max-min))); 
        // if(new_val==0)
        // {
        //   new_val=1;
        // } 
        // return cp_colors[new_val-1];

    }
    else if(chosen_scale==="gs")
    {     


      var len =orangeRedTruncate.length;
      var new_val = Math.ceil (len*((val-min)/(max-min))); 
      if(new_val==0)
      {
          new_val=1;
      } 
      return orangeRedTruncate[new_val-1];
    }
    else if(chosen_scale==="hs")
    {
        var t = (val-min)/(max-min);
        t=min_hue+(max_hue-min_hue)*t;
        return interpolateHue(t); 
    }
    else if(chosen_scale==="cl")
    {
        var values=new Array(averages.length);
        for(i=0;i<averages.length;i++)
        {
            values[i]=averages[i];
        }
        var range= new Array(cp_colors.length)
        for(i=0;i<cp_colors.length;i++)
        {
            range[i]=cp_colors[i];
        }
        var scale = d3.scaleCluster().domain(values).range(range);
        return scale(val); 
    }
    
}



  var map  =null;
  var legend =null;
  var california=null;
  var region_1 =null,region_2 =null,region_3 =null,region_4 =null,region_5 =null,region_6 =null,region_7 =null,region_8 =null,region_9 =null,region_10 =null;
  var region_11 =null,region_12 =null,region_13 =null,region_14 =null,region_15 =null,region_16 =null,region_17 =null,region_18 =null,region_19 =null,region_20 =null;
  var region_21 =null,region_22 =null,region_23 =null,region_24 =null,region_25 =null,region_26 =null,region_27 =null,region_28 =null,region_29 =null,region_30 =null;

  if(map==null)
   {
        map  =L
        .map('mapid')
        .setView([37, -120], 6);   // center position + zoom

        // // Add a tile to the map = a background. Comes from OpenStreetmap
        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
            maxZoom: 12,
            }).addTo(map);



        // Add a svg layer to the map
        L.svg().addTo(map);
    }

function draw_map(data_types,chosen_scale)
{
    
    console.log(chosen_scale);
   // mapid is the id of the div where the map will appear
   if(map==null)
   {
        map  =L
        .map('mapid')
        .setView([37, -120], 6);   // center position + zoom

        // // Add a tile to the map = a background. Comes from OpenStreetmap
        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
            maxZoom: 12,
            }).addTo(map);



        // Add a svg layer to the map
        L.svg().addTo(map);
    }

    if(data_types==3)
    {
        d3.csv("collated_ratings.csv", function(data) {
        var np=data.length;
        var r1=new Array(np),r2=new Array(np),r3=new Array(np),r4=new Array(np), r5=new Array(np);
        var r6=new Array(np),r7=new Array(np),r8=new Array(np),r9=new Array(np),r10=new Array(np);
        var r11=new Array(np),r12=new Array(np),r13=new Array(np),r14=new Array(np),r15=new Array(np);
        var r16=new Array(np),r17=new Array(np),r18=new Array(np),r19=new Array(np),r20=new Array(np);
        var r21=new Array(np),r22=new Array(np),r23=new Array(np),r24=new Array(np), r25=new Array(np);
        var r26=new Array(np),r27=new Array(np),r28=new Array(np),r29=new Array(np),r30=new Array(np);

        var sum = new Array(30);
        var Averages = new Array(30);
        var count = new Array(30);
        for (i=0; i <30; i++)
        {   
            sum[i]= 0;
            Averages[i]= 0;
            count[i]= 0;
        }
        for (i=0; i <np; i++)
        {           
            if(parseInt(data[i].cluster_30)===1)
            {
                r1[count[0]]=new Array(2);
                r1[count[0]][0]=parseFloat(data[i].latitude);
                r1[count[0]][1]=parseFloat(data[i].longitude);
                sum[0] = (parseFloat(data[i].cluster_30_rating));
                count[0]+=1;
            }
            if(parseInt(data[i].cluster_30)===2)
            {
                r2[count[1]]=new Array(2);
                r2[count[1]][0]=parseFloat(data[i].latitude);
                r2[count[1]][1]=parseFloat(data[i].longitude);
                sum[1] = (parseFloat(data[i].cluster_30_rating));
                count[1]+=1;
            }
            if(parseInt(data[i].cluster_30)===3)
            {
                
                r3[count[2]]=new Array(2);
                r3[count[2]][0]=parseFloat(data[i].latitude);
                r3[count[2]][1]=parseFloat(data[i].longitude);
                sum[2] = (parseFloat(data[i].cluster_30_rating));
                count[2]+=1;
            }
            if(parseInt(data[i].cluster_30)===4)
            {
                
                r4[count[3]]=new Array(2);
                r4[count[3]][0]=parseFloat(data[i].latitude);
                r4[count[3]][1]=parseFloat(data[i].longitude);
                sum[3] = (parseFloat(data[i].cluster_30_rating));
                count[3]+=1;
            }
            if(parseInt(data[i].cluster_30)===5)
            {
                
                r5[count[4]]=new Array(2);
                r5[count[4]][0]=parseFloat(data[i].latitude);
                r5[count[4]][1]=parseFloat(data[i].longitude);
                sum[4] = (parseFloat(data[i].cluster_30_rating));
                count[4]+=1;
            }
            if(parseInt(data[i].cluster_30)===6)
            {
                
                r6[count[5]]=new Array(2);
                r6[count[5]][0]=parseFloat(data[i].latitude);
                r6[count[5]][1]=parseFloat(data[i].longitude);
                sum[5] = (parseFloat(data[i].cluster_30_rating));
                count[5]+=1;
            }
            if(parseInt(data[i].cluster_30)===7)
            {
                
                r7[count[6]]=new Array(2);
                r7[count[6]][0]=parseFloat(data[i].latitude);
                r7[count[6]][1]=parseFloat(data[i].longitude);
                sum[6] = (parseFloat(data[i].cluster_30_rating));
                count[6]+=1;
            }
            if(parseInt(data[i].cluster_30)===8)
            {
                
                r8[count[7]]=new Array(2);
                r8[count[7]][0]=parseFloat(data[i].latitude);
                r8[count[7]][1]=parseFloat(data[i].longitude);
                sum[7] = (parseFloat(data[i].cluster_30_rating));
                count[7]+=1;
            }
            if(parseInt(data[i].cluster_30)===9)
            {
                
                r9[count[8]]=new Array(2);
                r9[count[8]][0]=parseFloat(data[i].latitude);
                r9[count[8]][1]=parseFloat(data[i].longitude);
                sum[8] = (parseFloat(data[i].cluster_30_rating));
                count[8]+=1;
            }
            if(parseInt(data[i].cluster_30)===10)
            {
                
                r10[count[9]]=new Array(2);
                r10[count[9]][0]=parseFloat(data[i].latitude);
                r10[count[9]][1]=parseFloat(data[i].longitude);
                sum[9] = (parseFloat(data[i].cluster_30_rating));
                count[9]+=1;
            }
            if(parseInt(data[i].cluster_30)===11)
            {
                
                r11[count[10]]=new Array(2);
                r11[count[10]][0]=parseFloat(data[i].latitude);
                r11[count[10]][1]=parseFloat(data[i].longitude);
               sum[10] = (parseFloat(data[i].cluster_30_rating));
               count[10]+=1;
            }
            if(parseInt(data[i].cluster_30)===12)
            {
                
                r12[count[11]]=new Array(2);
                r12[count[11]][0]=parseFloat(data[i].latitude);
                r12[count[11]][1]=parseFloat(data[i].longitude);
                sum[11] = (parseFloat(data[i].cluster_30_rating));
                count[11]+=1;
            }
            if(parseInt(data[i].cluster_30)===13)
            {
                
                r13[count[12]]=new Array(2);
                r13[count[12]][0]=parseFloat(data[i].latitude);
                r13[count[12]][1]=parseFloat(data[i].longitude);
                sum[12] = (parseFloat(data[i].cluster_30_rating));
                count[12]+=1;
            }
            if(parseInt(data[i].cluster_30)===14)
            {
                
                r14[count[13]]=new Array(2);
                r14[count[13]][0]=parseFloat(data[i].latitude);
                r14[count[13]][1]=parseFloat(data[i].longitude);
                sum[13] = (parseFloat(data[i].cluster_30_rating));
                count[13]+=1;;
            }
            if(parseInt(data[i].cluster_30)===15)
            {
                
                r15[count[14]]=new Array(2);
                r15[count[14]][0]=parseFloat(data[i].latitude);
                r15[count[14]][1]=parseFloat(data[i].longitude);
                sum[14] = (parseFloat(data[i].cluster_30_rating));
                count[14]+=1;;
            }
            if(parseInt(data[i].cluster_30)===16)
            {
                r16[count[15]]=new Array(2);
                r16[count[15]][0]=parseFloat(data[i].latitude);
                r16[count[15]][1]=parseFloat(data[i].longitude);
                sum[15] = (parseFloat(data[i].cluster_30_rating));
                count[15]+=1;; 
            }
            if(parseInt(data[i].cluster_30)===17)
            {
                r17[count[16]]=new Array(2);
                r17[count[16]][0]=parseFloat(data[i].latitude);
                r17[count[16]][1]=parseFloat(data[i].longitude);
                sum[16] =(parseFloat(data[i].cluster_30_rating));
                count[16]+=1;;
            }
            if(parseInt(data[i].cluster_30)===18)
            {
                
                r18[count[17]]=new Array(2);
                r18[count[17]][0]=parseFloat(data[i].latitude);
                r18[count[17]][1]=parseFloat(data[i].longitude);
                sum[17] = (parseFloat(data[i].cluster_30_rating));
                count[17]+=1;;
            }
            if(parseInt(data[i].cluster_30)===19)
            {
                
                r19[count[18]]=new Array(2);
                r19[count[18]][0]=parseFloat(data[i].latitude);
                r19[count[18]][1]=parseFloat(data[i].longitude);
                sum[18] = (parseFloat(data[i].cluster_30_rating));
                count[18]+=1;
            }
            if(parseInt(data[i].cluster_30)===20)
            {
                
                r20[count[19]]=new Array(2);
                r20[count[19]][0]=parseFloat(data[i].latitude);
                r20[count[19]][1]=parseFloat(data[i].longitude);
                sum[19] = (parseFloat(data[i].cluster_30_rating));
                count[19]+=1;
            }
            if(parseInt(data[i].cluster_30)===21)
            {
                
                r21[count[20]]=new Array(2);
                r21[count[20]][0]=parseFloat(data[i].latitude);
                r21[count[20]][1]=parseFloat(data[i].longitude);
                sum[20] = (parseFloat(data[i].cluster_30_rating));
                count[20]+=1;
            }
            if(parseInt(data[i].cluster_30)===22)
            {                   
                r22[count[21]]=new Array(2);
                r22[count[21]][0]=parseFloat(data[i].latitude);
                r22[count[21]][1]=parseFloat(data[i].longitude);
                sum[21] =(parseFloat(data[i].cluster_30_rating));
                count[21]+=1;
            }
            if(parseInt(data[i].cluster_30)===23)
            {               
                r23[count[22]]=new Array(2);
                r23[count[22]][0]=parseFloat(data[i].latitude);
                r23[count[22]][1]=parseFloat(data[i].longitude);
                sum[22] = (parseFloat(data[i].cluster_30_rating));
                count[22]+=1;
            }
            if(parseInt(data[i].cluster_30)===24)
            {               
                r24[count[23]]=new Array(2);
                r24[count[23]][0]=parseFloat(data[i].latitude);
                r24[count[23]][1]=parseFloat(data[i].longitude);
                sum[23] = (parseFloat(data[i].cluster_30_rating));
                count[23]+=1;
            }
            if(parseInt(data[i].cluster_30)===25)
            {               
                r25[count[24]]=new Array(2);
                r25[count[24]][0]=parseFloat(data[i].latitude);
                r25[count[24]][1]=parseFloat(data[i].longitude);
                sum[24] =(parseFloat(data[i].cluster_30_rating));
                count[24]+=1;
            }
            if(parseInt(data[i].cluster_30)===26)
            {               
                r26[count[25]]=new Array(2);
                r26[count[25]][0]=parseFloat(data[i].latitude);
                r26[count[25]][1]=parseFloat(data[i].longitude);
                sum[25] = (parseFloat(data[i].cluster_30_rating));
                count[25]+=1;
            }
            if(parseInt(data[i].cluster_30)===27)
            {               
                r27[count[26]]=new Array(2);
                r27[count[26]][0]=parseFloat(data[i].latitude);
                r27[count[26]][1]=parseFloat(data[i].longitude);
                sum[26] = (parseFloat(data[i].cluster_30_rating));
                count[26]+=1;
            }
            if(parseInt(data[i].cluster_30)===28)
            {               
                r28[count[27]]=new Array(2);
                r28[count[27]][0]=parseFloat(data[i].latitude);
                r28[count[27]][1]=parseFloat(data[i].longitude);
                sum[27] = (parseFloat(data[i].cluster_30_rating));
                count[27]+=1;
            }
            if(parseInt(data[i].cluster_30)===29)
            {               
                r29[count[28]]=new Array(2);
                r29[count[28]][0]=parseFloat(data[i].latitude);
                r29[count[28]][1]=parseFloat(data[i].longitude);
                sum[28] = (parseFloat(data[i].cluster_30_rating));
                count[28]+=1;
            }
            if(parseInt(data[i].cluster_30)===30)
            {
                
                r30[count[29]]=new Array(2);
                r30[count[29]][0]=parseFloat(data[i].latitude);
                r30[count[29]][1]=parseFloat(data[i].longitude);
                sum[29] = (parseFloat(data[i].cluster_30_rating));
                count[29]+=1;
            }
        }

       
        var averages = new Array(30);
        var actual_averages = new Array(30);
        var cnt=0;
        console.log("num,sum,count,averages");
        for (i=0; i <30; i++)
        {
            if(sum[i]>0)
            {
                averages[i]=sum[i];
                actual_averages[cnt] =sum[i];                
                console.log((i+1)+","+sum[i]+","+count[i]+","+averages[i]);
                cnt=cnt+1;              
            }   
        }
         var avg_max = actual_averages.reduce(function(a, b) {
            return Math.max(a, b);
        });

        var avg_min = actual_averages.reduce(function(a, b) {
            return Math.min(a, b);
        });
        



    if(legend!==null)
          map.removeControl(legend);

      
    if(chosen_scale!=="hs")
    {
        legend = L.control({position: 'bottomleft'});
        legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend'), labels = [];
        var colors_legend=["Very Low","Low","Moderate","High Moderate","High","Very High"];
        var colors_data=new Array(6)
        for(i=0;i<colors_legend.length;i++)
        {
            if(chosen_scale=="cb")
            {
                colors_data[i] = color_brewer[i];
            }
            else if(chosen_scale=="cp" || chosen_scale=="cl")
            {
                colors_data[i] = cp_colors[i];
            }
            else if(chosen_scale=="gs")
            {
                colors_data[i] = orangeRedTruncate[i];
            }
           
        }

        div.innerHTML = '<h1>Earthquake & Fire</h1><br>';
        // loop through indices and generate a label with a colored square for each interval
        for (var i = 0; i < colors_legend.length; i++) {
            div.innerHTML +='<i style="background:' + colors_data[i]+ '"></i><b> '+ colors_legend[i]+ '</b><br>';

        }
        return div;
        };
         legend.addTo(map);
    }
    else{

            legend = L.control({position: 'bottomleft'});
            legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'), labels = [];            
            var colors_data=new Array(100)
            for(i=0;i<100;i++)
            {
                var t=min_hue+(max_hue-min_hue)*i/100;
                colors_data[i]= interpolateHue(t);
            }

            div.innerHTML = '<h1>Earthquake & Fire</h1><br>';
            // loop through indices and generate a label with a colored square for each interval
            for (var i = 0; i < 100; i++) {
                if(i===0)
                {
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"><b>Low</b></j>';
                }else if(i===86)
                {
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"><b>High</b></j>';
                   
                }
                else{
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"></j>';
                }
            }
            return div;
            };


            legend.addTo(map);
     }
   

        

        
    
        r1=r1.slice(0,count[0]);
        r2=r2.slice(0,count[1]);
        r3=r3.slice(0,count[2]);
        r4=r4.slice(0,count[3]);
        r5=r5.slice(0,count[4]);
        r6=r6.slice(0,count[5]);
        r7=r7.slice(0,count[6]);
        r8=r8.slice(0,count[7]);
        r9=r9.slice(0,count[8]);
        r10=r10.slice(0,count[9]);
        r11=r11.slice(0,count[10]);
        r12=r12.slice(0,count[11]);
        r13=r13.slice(0,count[12]);
        r14=r14.slice(0,count[13]);
        r15=r15.slice(0,count[14]);
        r16=r16.slice(0,count[15]);
        r17=r17.slice(0,count[16]);
        r18=r18.slice(0,count[17]);
        r19=r19.slice(0,count[18]);
        r20=r20.slice(0,count[19]);
        r21=r21.slice(0,count[20]);
        r22=r22.slice(0,count[21]);
        r23=r23.slice(0,count[22]);
        r24=r24.slice(0,count[23]);
        r25=r25.slice(0,count[24]);
        r26=r26.slice(0,count[25]);
        r27=r27.slice(0,count[26]);
        r28=r28.slice(0,count[27]);
        r29=r29.slice(0,count[28]);
        r30=r30.slice(0,count[29]);

        var californiaboundary=[
            [41.9983,-124.4009], [42.0024,-123.6237], [42.0126,-123.1526], [42.0075,-122.0073], [41.9962,-121.2369], [41.9983,-119.9982], [39.0021,-120.0037],
            [37.5555,-117.9575], [36.3594,-116.3699], [35.0075,-114.6368], [34.9659,-114.6382], [34.9107,-114.6286], [34.8758,-114.6382], [34.8454,-114.5970],
            [34.7890,-114.5682], [34.7269,-114.4968], [34.6648,-114.4501], [34.6581,-114.4597], [34.5869,-114.4322], [34.5235,-114.3787], [34.4601,-114.3869],
            [34.4500,-114.3361], [34.4375,-114.3031], [34.4024,-114.2674], [34.3559,-114.1864], [34.3049,-114.1383], [34.2561,-114.1315], [34.2595,-114.1651], 
            [34.2044,-114.2249], [34.1914,-114.2221], [34.1720,-114.2908], [34.1368,-114.3237], [34.1186,-114.3622], [34.1118,-114.4089], [34.0856,-114.4363], 
            [34.0276,-114.4336], [34.0117,-114.4652], [33.9582,-114.5119], [33.9308,-114.5366], [33.9058,-114.5091], [33.8613,-114.5256], [33.8248,-114.5215], 
            [33.7597,-114.5050], [33.7083,-114.4940], [33.6832,-114.5284], [33.6363,-114.5242], [33.5895,-114.5393], [33.5528,-114.5242], [33.5311,-114.5586], 
            [33.5070,-114.5778], [33.4418,-114.6245], [33.4142,-114.6506], [33.4039,-114.7055], [33.3546,-114.6973], [33.3041,-114.7302], [33.2858,-114.7206], 
            [33.2754,-114.6808], [33.2582,-114.6698], [33.2467,-114.6904], [33.1720,-114.6794], [33.0904,-114.7083], [33.0858,-114.6918], [33.0328,-114.6629], 
            [33.0501,-114.6451], [33.0305,-114.6286], [33.0282,-114.5888], [33.0351,-114.5750], [33.0328,-114.5174], [32.9718,-114.4913], [32.9764,-114.4775],
            [32.9372,-114.4844], [32.8427,-114.4679], [32.8161,-114.5091], [32.7850,-114.5311], [32.7573,-114.5284], [32.7503,-114.5641], [32.7353,-114.6162], 
            [32.7480,-114.6986], [32.7191,-114.7220], [32.6868,-115.1944], [32.5121,-117.3395], [32.7838,-117.4823], [33.0501,-117.5977], [33.2341,-117.6814], 
            [33.4578,-118.0591], [33.5403,-118.6290], [33.7928,-118.7073], [33.9582,-119.3706], [34.1925,-120.0050], [34.2561,-120.7164], [34.5360,-120.9128], 
            [34.9749,-120.8427], [35.2131,-121.1325], [35.5255,-121.3220], [35.9691,-121.8013], [36.2808,-122.1446], [36.7268,-122.1721], [37.2227,-122.6871],  
            [37.7783,-122.8903], [37.8965,-123.2378], [38.3449,-123.3202], [38.7423,-123.8338], [38.9946,-123.9793], [39.3088,-124.0329], [39.7642,-124.0823],
            [40.1663,-124.5314], [40.4658,-124.6509], [41.0110,-124.3144], [41.2386,-124.3419], [41.7170,-124.4545], [41.9983,-124.4009]];




        // var region_0 = L.polygon(d3.polygonHull(r1), {
        //     //color:get_region_color(averages,avg_max,avg_min,cnt,averages[0]), 
        //     opacity: 0, 
        //   //  fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[0]),
        //   fillColor: "radialGradient(0.5,0.5,90%,50%,50%,color:get_region_color(averages,avg_max,avg_min,cnt,averages[0],get_region_color(averages,avg_max,avg_min,cnt,averages[0])",
        //     fillOpacity:0.7}).addTo(map);

       // var region_1 =null,region_2 =null,region_3 =null,region_4 =null,region_5 =null,region_6 =null,region_7 =null,region_8 =null,region_9 =null,region_10 =null;

       if (california) {
            california.remove();
        }

        if (region_1) {
            region_1.remove();
        }
        
        if (region_2) {
            region_2.remove();
        }
        
        if (region_3) {
            region_3.remove();
        }
        
        if (region_4) {
            region_4.remove();
        }
        
        if (region_5) {
            region_5.remove();
        }
        
        if (region_6) {
            region_6.remove();
        }
        
        if (region_7) {
            region_7.remove();
        }
        
        if (region_8) {
            region_8.remove();
        }
        
        if (region_9) {
            region_9.remove();
        }
        
        if (region_10) {
            region_10.remove();
        }        
        if (region_11) {
            region_11.remove();
        }        
        if (region_12) {
            region_12.remove();
        }        
        if (region_13) {
            region_13.remove();
        }        
        if (region_14) {
            region_14.remove();
        }        
        if (region_15) {
            region_15.remove();
        }
        if (region_16) {
            region_16.remove();
        }
        if (region_17) {
            region_17.remove();
        }
        if (region_18) {
            region_18.remove();
        }
        if (region_19) {
            region_19.remove();
        }
        if (region_20) {
            region_20.remove();
        }    

        if (region_21) {
            region_21.remove();
        }        
        if (region_22) {
            region_22.remove();
        }        
        if (region_23) {
            region_23.remove();
        }        
        if (region_24) {
            region_24.remove();
        }        
        if (region_25) {
            region_25.remove();
        }        
        if (region_26) {
            region_26.remove();
        }
        if (region_27) {
            region_27.remove();
        }
        if (region_28) {
            region_28.remove();
        }
        if (region_29) {
            region_29.remove();
        }
        if (region_30) {
            region_30.remove();
        }


   

       
         california = L.polygon(californiaboundary, {color:"#000", opacity: 0.9,fillColor:"#000",fillOpacity:0.01}).addTo(map);
         region_1 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r1)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[0]), opacity: 0,fillColor:get_region_color(averages,avg_max,avg_min,cnt,averages[0]),fillOpacity:0.7}).addTo(map);
        region_2 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r2)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[1]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[1]),fillOpacity:0.7}).addTo(map);
        region_3 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r3)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[2]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[2]),fillOpacity:0.7}).addTo(map);
        region_4 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r4)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[3]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[3]),fillOpacity:0.7}).addTo(map);
        region_5 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r5)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[4]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[4]),fillOpacity:0.7}).addTo(map);
        region_6 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r6)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[5]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[5]),fillOpacity:0.7}).addTo(map);
        region_7 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r7)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[6]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[6]),fillOpacity:0.7}).addTo(map);
        region_8 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r8)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[7]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[7]),fillOpacity:0.7}).addTo(map);
        region_9 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r9)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[8]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[8]),fillOpacity:0.7}).addTo(map);  
        region_10 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r10)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[9]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[9]),fillOpacity:0.7}).addTo(map);      
        region_11 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r11)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[10]), opacity: 0,fillColor:get_region_color(averages,avg_max,avg_min,cnt,averages[10]),fillOpacity:0.7}).addTo(map);
        region_12 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r12)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[11]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[11]),fillOpacity:0.7}).addTo(map);
        region_13 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r13)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[12]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[12]),fillOpacity:0.7}).addTo(map);
        region_14 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r14)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[13]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[13]),fillOpacity:0.7}).addTo(map);
        region_15 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r15)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[14]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[14]),fillOpacity:0.7}).addTo(map);
        region_16 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r16)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[15]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[15]),fillOpacity:0.7}).addTo(map);
        region_17 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r17)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[16]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[16]),fillOpacity:0.7}).addTo(map);
        region_18 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r18)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[17]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[17]),fillOpacity:0.7}).addTo(map);
        region_19 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r19)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[18]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[18]),fillOpacity:0.7}).addTo(map);  
        region_20 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r20)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[19]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[19]),fillOpacity:0.7}).addTo(map);      
        region_21 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r21)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[20]), opacity: 0,fillColor:get_region_color(averages,avg_max,avg_min,cnt,averages[20]),fillOpacity:0.7}).addTo(map);
        region_22 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r22)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[21]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[21]),fillOpacity:0.7}).addTo(map);
        region_23 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r23)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[22]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[22]),fillOpacity:0.7}).addTo(map);
        region_24 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r24)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[23]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[23]),fillOpacity:0.7}).addTo(map);
        region_25 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r25)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[24]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[24]),fillOpacity:0.7}).addTo(map);
        region_26 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r26)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[25]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[25]),fillOpacity:0.7}).addTo(map);
        region_27 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r27)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[26]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[26]),fillOpacity:0.7}).addTo(map);
        region_28 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r28)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[27]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[27]),fillOpacity:0.7}).addTo(map);
        region_29 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r29)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[28]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[28]),fillOpacity:0.7}).addTo(map);  
        region_30 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r30)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[29]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[29]),fillOpacity:0.7}).addTo(map);  
        region_1.bindTooltip(averages[0].toString()).openTooltip();
        region_2.bindTooltip(averages[1].toString()).openTooltip();
        region_3.bindTooltip(averages[2].toString()).openTooltip();
        region_4.bindTooltip(averages[3].toString()).openTooltip();
        region_5.bindTooltip(averages[4].toString()).openTooltip();
        region_6.bindTooltip(averages[5].toString()).openTooltip();
        region_7.bindTooltip(averages[6].toString()).openTooltip();
        region_8.bindTooltip(averages[7].toString()).openTooltip();
        region_9.bindTooltip(averages[8].toString()).openTooltip();
        region_10.bindTooltip(averages[9].toString()).openTooltip();
        region_11.bindTooltip(averages[10].toString()).openTooltip();
        region_12.bindTooltip(averages[11].toString()).openTooltip(); 
        region_13.bindTooltip(averages[12].toString()).openTooltip();  
        region_14.bindTooltip(averages[13].toString()).openTooltip();
        region_15.bindTooltip(averages[14].toString()).openTooltip();
        region_16.bindTooltip(averages[15].toString()).openTooltip();
        region_17.bindTooltip(averages[16].toString()).openTooltip();
        region_18.bindTooltip(averages[17].toString()).openTooltip();
        region_19.bindTooltip(averages[18].toString()).openTooltip();
        region_20.bindTooltip(averages[19].toString()).openTooltip();
        region_21.bindTooltip(averages[20].toString()).openTooltip();
        region_22.bindTooltip(averages[21].toString()).openTooltip();
        region_23.bindTooltip(averages[22].toString()).openTooltip();
        region_24.bindTooltip(averages[23].toString()).openTooltip();
        region_25.bindTooltip(averages[24].toString()).openTooltip();
        region_26.bindTooltip(averages[25].toString()).openTooltip();
        region_27.bindTooltip(averages[26].toString()).openTooltip();
        region_28.bindTooltip(averages[27].toString()).openTooltip();
        region_29.bindTooltip(averages[28].toString()).openTooltip();
        region_30.bindTooltip(averages[29].toString()).openTooltip();
  


          
    });
    }
    else  if(data_types==1)
    {
        d3.csv("fire_clusters_rated.csv", function(data){
        var np=data.length;
        var r1=new Array(np),r2=new Array(np),r3=new Array(np),r4=new Array(np), r5=new Array(np);
        var r6=new Array(np),r7=new Array(np),r8=new Array(np),r9=new Array(np),r10=new Array(np);
        var r11=new Array(np),r12=new Array(np),r13=new Array(np),r14=new Array(np),r15=new Array(np);
        var r16=new Array(np),r17=new Array(np),r18=new Array(np),r19=new Array(np),r20=new Array(np);
        var r21=new Array(np),r22=new Array(np),r23=new Array(np),r24=new Array(np), r25=new Array(np);
        var r26=new Array(np),r27=new Array(np),r28=new Array(np),r29=new Array(np),r30=new Array(np);

        var sum = new Array(19);
        var Averages = new Array(19);
        var count = new Array(19);
        for (i=0; i <30; i++)
        {   
            sum[i]= 0;
            Averages[i]= 0;
            count[i]= 0;
        }
        for (i=0; i <np; i++)
        {           
            if(parseInt(data[i].f_cluster_19)===1)
            {
                r1[count[0]]=new Array(2);
                r1[count[0]][0]=parseFloat(data[i].latitude);
                r1[count[0]][1]=parseFloat(data[i].longitude);
                sum[0] = (parseFloat(data[i].f_cluster_19_rating));
                count[0]=count[0]+1; 
            }
            if(parseInt(data[i].f_cluster_19)===2)
            {
                r2[count[1]]=new Array(2);
                r2[count[1]][0]=parseFloat(data[i].latitude);
                r2[count[1]][1]=parseFloat(data[i].longitude);
                sum[1] = (parseFloat(data[i].f_cluster_19_rating));
                count[1]=count[1]+1;
            }
            if(parseInt(data[i].f_cluster_19)===3)
            {
                
                r3[count[2]]=new Array(2);
                r3[count[2]][0]=parseFloat(data[i].latitude);
                r3[count[2]][1]=parseFloat(data[i].longitude);
                sum[2] = (parseFloat(data[i].f_cluster_19_rating));
                count[2]=count[2]+1;
            }
            if(parseInt(data[i].f_cluster_19)===4)
            {
                
                r4[count[3]]=new Array(2);
                r4[count[3]][0]=parseFloat(data[i].latitude);
                r4[count[3]][1]=parseFloat(data[i].longitude);
                sum[3] = (parseFloat(data[i].f_cluster_19_rating));
                count[3]=count[3]+1;
            }
            if(parseInt(data[i].f_cluster_19)===5)
            {
                
                r5[count[4]]=new Array(2);
                r5[count[4]][0]=parseFloat(data[i].latitude);
                r5[count[4]][1]=parseFloat(data[i].longitude);
                sum[4] =(parseFloat(data[i].f_cluster_19_rating));
                count[4]=count[4]+1;
            }
            if(parseInt(data[i].f_cluster_19)===6)
            {
                
                r6[count[5]]=new Array(2);
                r6[count[5]][0]=parseFloat(data[i].latitude);
                r6[count[5]][1]=parseFloat(data[i].longitude);
                sum[5] =(parseFloat(data[i].f_cluster_19_rating));
                count[5]=count[5]+1;
            }
            if(parseInt(data[i].f_cluster_19)===7)
            {
                
                r7[count[6]]=new Array(2);
                r7[count[6]][0]=parseFloat(data[i].latitude);
                r7[count[6]][1]=parseFloat(data[i].longitude);
                sum[6] =(parseFloat(data[i].f_cluster_19_rating));
                count[6]=count[6]+1;
            }
            if(parseInt(data[i].f_cluster_19)===8)
            {
                
                r8[count[7]]=new Array(2);
                r8[count[7]][0]=parseFloat(data[i].latitude);
                r8[count[7]][1]=parseFloat(data[i].longitude);
                sum[7] =(parseFloat(data[i].f_cluster_19_rating));
                count[7]=count[7]+1;
            }
            if(parseInt(data[i].f_cluster_19)===9)
            {
                
                r9[count[8]]=new Array(2);
                r9[count[8]][0]=parseFloat(data[i].latitude);
                r9[count[8]][1]=parseFloat(data[i].longitude);
                sum[8] =(parseFloat(data[i].f_cluster_19_rating));
                count[8]=count[8]+1;
            }
            if(parseInt(data[i].f_cluster_19)===10)
            {
                
                r10[count[9]]=new Array(2);
                r10[count[9]][0]=parseFloat(data[i].latitude);
                r10[count[9]][1]=parseFloat(data[i].longitude);
                sum[9] =(parseFloat(data[i].f_cluster_19_rating));
                count[9]=count[9]+1;
            }
            if(parseInt(data[i].f_cluster_19)===11)
            {
                
                r11[count[10]]=new Array(2);
                r11[count[10]][0]=parseFloat(data[i].latitude);
                r11[count[10]][1]=parseFloat(data[i].longitude);
               sum[10] =(parseFloat(data[i].f_cluster_19_rating));
               count[10]=count[10]+1;
            }
            if(parseInt(data[i].f_cluster_19)===12)
            {
                
                r12[count[11]]=new Array(2);
                r12[count[11]][0]=parseFloat(data[i].latitude);
                r12[count[11]][1]=parseFloat(data[i].longitude);
                sum[11] =(parseFloat(data[i].f_cluster_19_rating));
                count[11]=count[11]+1;
            }
            if(parseInt(data[i].f_cluster_19)===13)
            {
                
                r13[count[12]]=new Array(2);
                r13[count[12]][0]=parseFloat(data[i].latitude);
                r13[count[12]][1]=parseFloat(data[i].longitude);
                sum[12] =(parseFloat(data[i].f_cluster_19_rating));
                count[12]=count[12]+1;
            }
            if(parseInt(data[i].f_cluster_19)===14)
            {
                
                r14[count[13]]=new Array(2);
                r14[count[13]][0]=parseFloat(data[i].latitude);
                r14[count[13]][1]=parseFloat(data[i].longitude);
                sum[13] =(parseFloat(data[i].f_cluster_19_rating));
                count[13]=count[13]+1;
            }
            if(parseInt(data[i].f_cluster_19)===15)
            {
                
                r15[count[14]]=new Array(2);
                r15[count[14]][0]=parseFloat(data[i].latitude);
                r15[count[14]][1]=parseFloat(data[i].longitude);
                sum[14] =(parseFloat(data[i].f_cluster_19_rating));
                count[14]=count[14]+1;
            }
            if(parseInt(data[i].f_cluster_19)===16)
            {
                r16[count[15]]=new Array(2);
                r16[count[15]][0]=parseFloat(data[i].latitude);
                r16[count[15]][1]=parseFloat(data[i].longitude);
                sum[15] =(parseFloat(data[i].f_cluster_19_rating));
                count[15]=count[15]+1; 
            }
            if(parseInt(data[i].f_cluster_19)===17)
            {
                r17[count[16]]=new Array(2);
                r17[count[16]][0]=parseFloat(data[i].latitude);
                r17[count[16]][1]=parseFloat(data[i].longitude);
                sum[16] =(parseFloat(data[i].f_cluster_19_rating));
                count[16]=count[16]+1;
            }
            if(parseInt(data[i].f_cluster_19)===18)
            {
                
                r18[count[17]]=new Array(2);
                r18[count[17]][0]=parseFloat(data[i].latitude);
                r18[count[17]][1]=parseFloat(data[i].longitude);
                sum[17] =(parseFloat(data[i].f_cluster_19_rating));
                count[17]=count[17]+1;
            }
            if(parseInt(data[i].f_cluster_19)===19)
            {
                
                r19[count[18]]=new Array(2);
                r19[count[18]][0]=parseFloat(data[i].latitude);
                r19[count[18]][1]=parseFloat(data[i].longitude);
                sum[18] = (parseFloat(data[i].f_cluster_19_rating));
                count[18]=count[18]+1;
            }
            
        }

       
        var averages = new Array(19);
        var actual_averages = new Array(19);
        var cnt=0;
        console.log("num,sum,count,averages");
        for (i=0; i <19; i++)
        {
            if(sum[i]>0)
            {
                averages[i]=sum[i];
                actual_averages[cnt] =sum[i];                
                console.log((i+1)+","+sum[i]+","+count[i]+","+averages[i]);
                cnt=cnt+1;              
            }   
        }

         var avg_max = actual_averages.reduce(function(a, b) {
            return Math.max(a, b);
        });

        var avg_min = actual_averages.reduce(function(a, b) {
            return Math.min(a, b);
        });
        

	// 'interpolateViridis',
	// 'interpolateInferno',
	// 'interpolateMagma',
	// 'interpolatePlasma',
	// 'interpolateWarm',
	// 'interpolateCool',
	// 'interpolateRainbow',
	// 'interpolateCubehelixDefault'


        const scale = d3.scaleSequential()
            .domain(d3.extent(actual_averages))
            .interpolator(d3.interpolateRainbow);
            

        if(legend!==null)
          map.removeControl(legend);

    if(chosen_scale!=="hs")
    {
        legend = L.control({position: 'bottomleft'});
        legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend'), labels = [];
        var colors_legend=["Very Low","Low","Moderate","High Moderate","High","Very High"];
        var colors_data=new Array(6)
        for(i=0;i<colors_legend.length;i++)
        {
            if(chosen_scale=="cb")
            {
                colors_data[i] = color_brewer[i];
            }
            else if(chosen_scale=="cp" || chosen_scale=="cl")
            {
                colors_data[i] = cp_colors[i];
            }
            else if(chosen_scale=="gs")
            {
                colors_data[i] = orangeRedTruncate[i];
            }
        }

        div.innerHTML = '<h1>Fire</h1><br>';
        // loop through indices and generate a label with a colored square for each interval
        for (var i = 0; i < colors_legend.length; i++) {
            div.innerHTML +='<i style="background:' + colors_data[i]+ '"></i><b> '+ colors_legend[i]+ '</b><br>';

        }
        return div;
        };
         legend.addTo(map);
    }
    else{

            legend = L.control({position: 'bottomleft'});
            legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'), labels = [];            
            var colors_data=new Array(100)
            for(i=0;i<100;i++)
            {
                var t=min_hue+(max_hue-min_hue)*i/100;
                colors_data[i]= interpolateHue(t);
            }

            div.innerHTML = '<h1>Fire</h1><br>';
                        // loop through indices and generate a label with a colored square for each interval
            for (var i = 0; i < 100; i++) {
                if(i===0)
                {
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"><b>Low</b></j>';
                }else if(i===86)
                {
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"><b>High</b></j>';
                   
                }
                else{
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"></j>';
                }
            }
            return div;
            };


            legend.addTo(map);
     }
   

        
    
        r1=r1.slice(0,count[0]);
        r2=r2.slice(0,count[1]);
        r3=r3.slice(0,count[2]);
        r4=r4.slice(0,count[3]);
        r5=r5.slice(0,count[4]);
        r6=r6.slice(0,count[5]);
        r7=r7.slice(0,count[6]);
        r8=r8.slice(0,count[7]);
        r9=r9.slice(0,count[8]);
        r10=r10.slice(0,count[9]);
        r11=r11.slice(0,count[10]);
        r12=r12.slice(0,count[11]);
        r13=r13.slice(0,count[12]);
        r14=r14.slice(0,count[13]);
        r15=r15.slice(0,count[14]);
        r16=r16.slice(0,count[15]);
        r17=r17.slice(0,count[16]);
        r18=r18.slice(0,count[17]);
        r19=r19.slice(0,count[18]);

        var californiaboundary=[
            [41.9983,-124.4009], [42.0024,-123.6237], [42.0126,-123.1526], [42.0075,-122.0073], [41.9962,-121.2369], [41.9983,-119.9982], [39.0021,-120.0037],
            [37.5555,-117.9575], [36.3594,-116.3699], [35.0075,-114.6368], [34.9659,-114.6382], [34.9107,-114.6286], [34.8758,-114.6382], [34.8454,-114.5970],
            [34.7890,-114.5682], [34.7269,-114.4968], [34.6648,-114.4501], [34.6581,-114.4597], [34.5869,-114.4322], [34.5235,-114.3787], [34.4601,-114.3869],
            [34.4500,-114.3361], [34.4375,-114.3031], [34.4024,-114.2674], [34.3559,-114.1864], [34.3049,-114.1383], [34.2561,-114.1315], [34.2595,-114.1651], 
            [34.2044,-114.2249], [34.1914,-114.2221], [34.1720,-114.2908], [34.1368,-114.3237], [34.1186,-114.3622], [34.1118,-114.4089], [34.0856,-114.4363], 
            [34.0276,-114.4336], [34.0117,-114.4652], [33.9582,-114.5119], [33.9308,-114.5366], [33.9058,-114.5091], [33.8613,-114.5256], [33.8248,-114.5215], 
            [33.7597,-114.5050], [33.7083,-114.4940], [33.6832,-114.5284], [33.6363,-114.5242], [33.5895,-114.5393], [33.5528,-114.5242], [33.5311,-114.5586], 
            [33.5070,-114.5778], [33.4418,-114.6245], [33.4142,-114.6506], [33.4039,-114.7055], [33.3546,-114.6973], [33.3041,-114.7302], [33.2858,-114.7206], 
            [33.2754,-114.6808], [33.2582,-114.6698], [33.2467,-114.6904], [33.1720,-114.6794], [33.0904,-114.7083], [33.0858,-114.6918], [33.0328,-114.6629], 
            [33.0501,-114.6451], [33.0305,-114.6286], [33.0282,-114.5888], [33.0351,-114.5750], [33.0328,-114.5174], [32.9718,-114.4913], [32.9764,-114.4775],
            [32.9372,-114.4844], [32.8427,-114.4679], [32.8161,-114.5091], [32.7850,-114.5311], [32.7573,-114.5284], [32.7503,-114.5641], [32.7353,-114.6162], 
            [32.7480,-114.6986], [32.7191,-114.7220], [32.6868,-115.1944], [32.5121,-117.3395], [32.7838,-117.4823], [33.0501,-117.5977], [33.2341,-117.6814], 
            [33.4578,-118.0591], [33.5403,-118.6290], [33.7928,-118.7073], [33.9582,-119.3706], [34.1925,-120.0050], [34.2561,-120.7164], [34.5360,-120.9128], 
            [34.9749,-120.8427], [35.2131,-121.1325], [35.5255,-121.3220], [35.9691,-121.8013], [36.2808,-122.1446], [36.7268,-122.1721], [37.2227,-122.6871],  
            [37.7783,-122.8903], [37.8965,-123.2378], [38.3449,-123.3202], [38.7423,-123.8338], [38.9946,-123.9793], [39.3088,-124.0329], [39.7642,-124.0823],
            [40.1663,-124.5314], [40.4658,-124.6509], [41.0110,-124.3144], [41.2386,-124.3419], [41.7170,-124.4545], [41.9983,-124.4009]];




        // var region_0 = L.polygon(d3.polygonHull(r1), {
        //     //color:get_region_color(averages,avg_max,avg_min,cnt,averages[0]), 
        //     opacity: 0, 
        //   //  fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[0]),
        //  // fillColor: "radialGradient(0.5,0.5,90%,50%,50%,color:get_region_color(averages,avg_max,avg_min,cnt,averages[0],get_region_color(averages,avg_max,avg_min,cnt,averages[0])",
        //     fillOpacity:0.7}).addTo(map);

       // var region_1 =null,region_2 =null,region_3 =null,region_4 =null,region_5 =null,region_6 =null,region_7 =null,region_8 =null,region_9 =null,region_10 =null;
       
       if (california) {
            california.remove();
        }

        if (region_1) {
            region_1.remove();
        }
        
        if (region_2) {
            region_2.remove();
        }
        
        if (region_3) {
            region_3.remove();
        }
        
        if (region_4) {
            region_4.remove();
        }
        
        if (region_5) {
            region_5.remove();
        }
        
        if (region_6) {
            region_6.remove();
        }
        
        if (region_7) {
            region_7.remove();
        }
        
        if (region_8) {
            region_8.remove();
        }
        
        if (region_9) {
            region_9.remove();
        }
        
        if (region_10) {
            region_10.remove();
        }        
        if (region_11) {
            region_11.remove();
        }        
        if (region_12) {
            region_12.remove();
        }        
        if (region_13) {
            region_13.remove();
        }        
        if (region_14) {
            region_14.remove();
        }        
        if (region_15) {
            region_15.remove();
        }
        if (region_16) {
            region_16.remove();
        }
        if (region_17) {
            region_17.remove();
        }
        if (region_18) {
            region_18.remove();
        }
        if (region_19) {
            region_19.remove();
        }
        if (region_20) {
            region_20.remove();
        }    

        if (region_21) {
            region_21.remove();
        }        
        if (region_22) {
            region_22.remove();
        }        
        if (region_23) {
            region_23.remove();
        }        
        if (region_24) {
            region_24.remove();
        }        
        if (region_25) {
            region_25.remove();
        }        
        if (region_26) {
            region_26.remove();
        }
        if (region_27) {
            region_27.remove();
        }
        if (region_28) {
            region_28.remove();
        }
        if (region_29) {
            region_29.remove();
        }
        if (region_30) {
            region_30.remove();
        }



       
        california = L.polygon(californiaboundary, {color:"#000", opacity: 0.9,fillColor:"#000",fillOpacity:0.01}).addTo(map);
        region_1 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r1)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[0]), opacity: 0,fillColor:get_region_color(averages,avg_max,avg_min,cnt,averages[0]),fillOpacity:0.7}).addTo(map);
        region_2 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r2)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[1]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[1]),fillOpacity:0.7}).addTo(map);
        region_3 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r3)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[2]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[2]),fillOpacity:0.7}).addTo(map);
        region_4 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r4)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[3]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[3]),fillOpacity:0.7}).addTo(map);
        region_5 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r5)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[4]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[4]),fillOpacity:0.7}).addTo(map);
        region_6 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r6)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[5]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[5]),fillOpacity:0.7}).addTo(map);
        region_7 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r7)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[6]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[6]),fillOpacity:0.7}).addTo(map);
        region_8 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r8)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[7]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[7]),fillOpacity:0.7}).addTo(map);
        region_9 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r9)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[8]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[8]),fillOpacity:0.7}).addTo(map);  
        region_10 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r10)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[9]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[9]),fillOpacity:0.7}).addTo(map);      
        region_11 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r11)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[10]), opacity: 0,fillColor:get_region_color(averages,avg_max,avg_min,cnt,averages[10]),fillOpacity:0.7}).addTo(map);
        region_12 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r12)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[11]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[11]),fillOpacity:0.7}).addTo(map);
        region_13 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r13)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[12]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[12]),fillOpacity:0.7}).addTo(map);
        region_14 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r14)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[13]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[13]),fillOpacity:0.7}).addTo(map);
        region_15 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r15)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[14]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[14]),fillOpacity:0.7}).addTo(map);
        region_16 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r16)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[15]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[15]),fillOpacity:0.7}).addTo(map);
        region_17 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r17)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[16]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[16]),fillOpacity:0.7}).addTo(map);
        region_18 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r18)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[17]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[17]),fillOpacity:0.7}).addTo(map);
        region_19 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r19)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[18]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[18]),fillOpacity:0.7}).addTo(map);  
       
        region_1.bindTooltip(averages[0].toString()).openTooltip();
        region_2.bindTooltip(averages[1].toString()).openTooltip();
        region_3.bindTooltip(averages[2].toString()).openTooltip();
        region_4.bindTooltip(averages[3].toString()).openTooltip();
        region_5.bindTooltip(averages[4].toString()).openTooltip();
        region_6.bindTooltip(averages[5].toString()).openTooltip();
        region_7.bindTooltip(averages[6].toString()).openTooltip();
        region_8.bindTooltip(averages[7].toString()).openTooltip();
        region_9.bindTooltip(averages[8].toString()).openTooltip();
        region_10.bindTooltip(averages[9].toString()).openTooltip();
        region_11.bindTooltip(averages[10].toString()).openTooltip();
        region_12.bindTooltip(averages[11].toString()).openTooltip();
        region_13.bindTooltip(averages[12].toString()).openTooltip();
        region_14.bindTooltip(averages[13].toString()).openTooltip();
        region_15.bindTooltip(averages[14].toString()).openTooltip();
        region_16.bindTooltip(averages[15].toString()).openTooltip();
        region_17.bindTooltip(averages[16].toString()).openTooltip();
        region_18.bindTooltip(averages[17].toString()).openTooltip();
        region_19.bindTooltip(averages[18].toString()).openTooltip();

   
    
          
    });
    }
    else  if(data_types==2)
    {
        d3.csv("earthquake_clusters_rated.csv", function(data){
        var np=data.length;
        var r1=new Array(np),r2=new Array(np),r3=new Array(np),r4=new Array(np), r5=new Array(np);
        var r6=new Array(np),r7=new Array(np),r8=new Array(np),r9=new Array(np),r10=new Array(np);
        var r11=new Array(np),r12=new Array(np),r13=new Array(np),r14=new Array(np),r15=new Array(np);
        var r16=new Array(np),r17=new Array(np),r18=new Array(np),r19=new Array(np),r20=new Array(np);
        var r21=new Array(np),r22=new Array(np),r23=new Array(np),r24=new Array(np), r25=new Array(np);
        var r26=new Array(np),r27=new Array(np),r28=new Array(np),r29=new Array(np),r30=new Array(np);

        var sum = new Array(20);
        var Averages = new Array(20);
        var count = new Array(20);
        for (i=0; i <20; i++)
        {   
            sum[i]= 0;
            Averages[i]= 0;
            count[i]= 0;
        }
        for (i=0; i <np; i++)
        {           
            if(parseInt(data[i].eq_cluster_20)===1)
            {
                r1[count[0]]=new Array(2);
                r1[count[0]][0]=parseFloat(data[i].latitude);
                r1[count[0]][1]=parseFloat(data[i].longitude);
                sum[0] = (parseFloat(data[i].eq_cluster_20_rating));
                count[0]=count[0]+1; 
            }
            if(parseInt(data[i].eq_cluster_20)===2)
            {
                r2[count[1]]=new Array(2);
                r2[count[1]][0]=parseFloat(data[i].latitude);
                r2[count[1]][1]=parseFloat(data[i].longitude);
                sum[1] = (parseFloat(data[i].eq_cluster_20_rating));
                count[1]=count[1]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===3)
            {
                
                r3[count[2]]=new Array(2);
                r3[count[2]][0]=parseFloat(data[i].latitude);
                r3[count[2]][1]=parseFloat(data[i].longitude);
                sum[2] =(parseFloat(data[i].eq_cluster_20_rating));
                count[2]=count[2]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===4)
            {
                
                r4[count[3]]=new Array(2);
                r4[count[3]][0]=parseFloat(data[i].latitude);
                r4[count[3]][1]=parseFloat(data[i].longitude);
                sum[3] =(parseFloat(data[i].eq_cluster_20_rating));
                count[3]=count[3]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===5)
            {
                
                r5[count[4]]=new Array(2);
                r5[count[4]][0]=parseFloat(data[i].latitude);
                r5[count[4]][1]=parseFloat(data[i].longitude);
                sum[4] =(parseFloat(data[i].eq_cluster_20_rating));
                count[4]=count[4]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===6)
            {
                
                r6[count[5]]=new Array(2);
                r6[count[5]][0]=parseFloat(data[i].latitude);
                r6[count[5]][1]=parseFloat(data[i].longitude);
                sum[5] = (parseFloat(data[i].eq_cluster_20_rating));
                count[5]=count[5]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===7)
            {
                
                r7[count[6]]=new Array(2);
                r7[count[6]][0]=parseFloat(data[i].latitude);
                r7[count[6]][1]=parseFloat(data[i].longitude);
                sum[6] = (parseFloat(data[i].eq_cluster_20_rating));
                count[6]=count[6]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===8)
            {
                
                r8[count[7]]=new Array(2);
                r8[count[7]][0]=parseFloat(data[i].latitude);
                r8[count[7]][1]=parseFloat(data[i].longitude);
                sum[7] =(parseFloat(data[i].eq_cluster_20_rating));
                count[7]=count[7]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===9)
            {
                
                r9[count[8]]=new Array(2);
                r9[count[8]][0]=parseFloat(data[i].latitude);
                r9[count[8]][1]=parseFloat(data[i].longitude);
                sum[8] = (parseFloat(data[i].eq_cluster_20_rating));
                count[8]=count[8]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===10)
            {
                
                r10[count[9]]=new Array(2);
                r10[count[9]][0]=parseFloat(data[i].latitude);
                r10[count[9]][1]=parseFloat(data[i].longitude);
                sum[9] = (parseFloat(data[i].eq_cluster_20_rating));
                count[9]=count[9]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===11)
            {
                
                r11[count[10]]=new Array(2);
                r11[count[10]][0]=parseFloat(data[i].latitude);
                r11[count[10]][1]=parseFloat(data[i].longitude);
               sum[10] =(parseFloat(data[i].eq_cluster_20_rating));
               count[10]=count[10]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===12)
            {
                
                r12[count[11]]=new Array(2);
                r12[count[11]][0]=parseFloat(data[i].latitude);
                r12[count[11]][1]=parseFloat(data[i].longitude);
                sum[11] = (parseFloat(data[i].eq_cluster_20_rating));
                count[11]=count[11]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===13)
            {
                
                r13[count[12]]=new Array(2);
                r13[count[12]][0]=parseFloat(data[i].latitude);
                r13[count[12]][1]=parseFloat(data[i].longitude);
                sum[12] = (parseFloat(data[i].eq_cluster_20_rating));
                count[12]=count[12]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===14)
            {
                
                r14[count[13]]=new Array(2);
                r14[count[13]][0]=parseFloat(data[i].latitude);
                r14[count[13]][1]=parseFloat(data[i].longitude);
                sum[13] =(parseFloat(data[i].eq_cluster_20_rating));
                count[13]=count[13]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===15)
            {
                
                r15[count[14]]=new Array(2);
                r15[count[14]][0]=parseFloat(data[i].latitude);
                r15[count[14]][1]=parseFloat(data[i].longitude);
                sum[14] = (parseFloat(data[i].eq_cluster_20_rating));
                count[14]=count[14]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===16)
            {
                r16[count[15]]=new Array(2);
                r16[count[15]][0]=parseFloat(data[i].latitude);
                r16[count[15]][1]=parseFloat(data[i].longitude);
                sum[15] =(parseFloat(data[i].eq_cluster_20_rating));
                count[15]=count[15]+1; 
            }
            if(parseInt(data[i].eq_cluster_20)===17)
            {
                r17[count[16]]=new Array(2);
                r17[count[16]][0]=parseFloat(data[i].latitude);
                r17[count[16]][1]=parseFloat(data[i].longitude);
                sum[16] =(parseFloat(data[i].eq_cluster_20_rating));
                count[16]=count[16]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===18)
            {
                
                r18[count[17]]=new Array(2);
                r18[count[17]][0]=parseFloat(data[i].latitude);
                r18[count[17]][1]=parseFloat(data[i].longitude);
                sum[17] =(parseFloat(data[i].eq_cluster_20_rating));
                count[17]=count[17]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===19)
            {
                
                r19[count[18]]=new Array(2);
                r19[count[18]][0]=parseFloat(data[i].latitude);
                r19[count[18]][1]=parseFloat(data[i].longitude);
                sum[18] = (parseFloat(data[i].eq_cluster_20_rating));
                count[18]=count[18]+1;
            }
            if(parseInt(data[i].eq_cluster_20)===20)
            {
                
                r19[count[19]]=new Array(2);
                r19[count[19]][0]=parseFloat(data[i].latitude);
                r19[count[19]][1]=parseFloat(data[i].longitude);
                sum[19] = (parseFloat(data[i].eq_cluster_20_rating));
                count[19]=count[19]+1;
            }
            
        }

       
        var averages = new Array(20);
        var actual_averages = new Array(20);
        var cnt=0;
        console.log("num,sum,count,averages");
        for (i=0; i <20; i++)
        {
            if(sum[i]>0)
            {
                averages[i]=sum[i];
                actual_averages[cnt] =sum[i];                
                console.log((i+1)+","+sum[i]+","+count[i]+","+averages[i]);
                cnt=cnt+1;              
            }   
        }

         var avg_max = actual_averages.reduce(function(a, b) {
            return Math.max(a, b);
        });

        var avg_min = actual_averages.reduce(function(a, b) {
            return Math.min(a, b);
        });
        

	// 'interpolateViridis',
	// 'interpolateInferno',
	// 'interpolateMagma',
	// 'interpolatePlasma',
	// 'interpolateWarm',
	// 'interpolateCool',
	// 'interpolateRainbow',
	// 'interpolateCubehelixDefault'


        const scale = d3.scaleSequential()
            .domain(d3.extent(actual_averages))
            .interpolator(d3.interpolateRainbow);
            

               
        if(legend!==null)
          map.removeControl(legend);
    
    if(chosen_scale!=="hs")
    {   
        legend = L.control({position: 'bottomleft'});
        legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend'), labels = [];
        var colors_legend=["Very Low","Low","Moderate","High Moderate","High","Very High"];
        var colors_data=new Array(6)
        for(i=0;i<colors_legend.length;i++)
        {
            if(chosen_scale=="cb")
            {
                colors_data[i] = color_brewer[i];
            }
            else if(chosen_scale=="cp" || chosen_scale=="cl")
            {
                colors_data[i] = cp_colors[i];
            }
            else if(chosen_scale=="gs")
            {
                colors_data[i] = orangeRedTruncate[i];
            }
        }

        div.innerHTML = '<h1>Earthquake</h1><br>';
        // loop through indices and generate a label with a colored square for each interval
        for (var i = 0; i < colors_legend.length; i++) {
            div.innerHTML +='<i style="background:' + colors_data[i]+ '"></i><b> '+ colors_legend[i]+ '</b><br>';

        }
        return div;
        };


        legend.addTo(map);
    }
    else{

 
        legend = L.control({position: 'bottomleft'});
            legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'), labels = [];            
            var colors_data=new Array(100)
            for(i=0;i<100;i++)
            {
                var t=min_hue+(max_hue-min_hue)*i/100;
                colors_data[i]= interpolateHue(t);
            }

            div.innerHTML = '<h1>Earthquake</h1><br>';
         
            // loop through indices and generate a label with a colored square for each interval
            for (var i = 0; i < 100; i++) {
                if(i===0)
                {
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"><b>Low</b></j>';
                }else if(i===86)
                {
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"><b>High</b></j>';
                   
                }
                else{
                    div.innerHTML +='<j style="background:' + colors_data[i]+ '"></j>';
                }
                

            }
            
            return div;
            };


            legend.addTo(map);
     }

        
    
        r1=r1.slice(0,count[0]);
        r2=r2.slice(0,count[1]);
        r3=r3.slice(0,count[2]);
        r4=r4.slice(0,count[3]);
        r5=r5.slice(0,count[4]);
        r6=r6.slice(0,count[5]);
        r7=r7.slice(0,count[6]);
        r8=r8.slice(0,count[7]);
        r9=r9.slice(0,count[8]);
        r10=r10.slice(0,count[9]);
        r11=r11.slice(0,count[10]);
        r12=r12.slice(0,count[11]);
        r13=r13.slice(0,count[12]);
        r14=r14.slice(0,count[13]);
        r15=r15.slice(0,count[14]);
        r16=r16.slice(0,count[15]);
        r17=r17.slice(0,count[16]);
        r18=r18.slice(0,count[17]);
        r19=r19.slice(0,count[18]);
        r20=r20.slice(0,count[19]);

        var californiaboundary=[
            [41.9983,-124.4009], [42.0024,-123.6237], [42.0126,-123.1526], [42.0075,-122.0073], [41.9962,-121.2369], [41.9983,-119.9982], [39.0021,-120.0037],
            [37.5555,-117.9575], [36.3594,-116.3699], [35.0075,-114.6368], [34.9659,-114.6382], [34.9107,-114.6286], [34.8758,-114.6382], [34.8454,-114.5970],
            [34.7890,-114.5682], [34.7269,-114.4968], [34.6648,-114.4501], [34.6581,-114.4597], [34.5869,-114.4322], [34.5235,-114.3787], [34.4601,-114.3869],
            [34.4500,-114.3361], [34.4375,-114.3031], [34.4024,-114.2674], [34.3559,-114.1864], [34.3049,-114.1383], [34.2561,-114.1315], [34.2595,-114.1651], 
            [34.2044,-114.2249], [34.1914,-114.2221], [34.1720,-114.2908], [34.1368,-114.3237], [34.1186,-114.3622], [34.1118,-114.4089], [34.0856,-114.4363], 
            [34.0276,-114.4336], [34.0117,-114.4652], [33.9582,-114.5119], [33.9308,-114.5366], [33.9058,-114.5091], [33.8613,-114.5256], [33.8248,-114.5215], 
            [33.7597,-114.5050], [33.7083,-114.4940], [33.6832,-114.5284], [33.6363,-114.5242], [33.5895,-114.5393], [33.5528,-114.5242], [33.5311,-114.5586], 
            [33.5070,-114.5778], [33.4418,-114.6245], [33.4142,-114.6506], [33.4039,-114.7055], [33.3546,-114.6973], [33.3041,-114.7302], [33.2858,-114.7206], 
            [33.2754,-114.6808], [33.2582,-114.6698], [33.2467,-114.6904], [33.1720,-114.6794], [33.0904,-114.7083], [33.0858,-114.6918], [33.0328,-114.6629], 
            [33.0501,-114.6451], [33.0305,-114.6286], [33.0282,-114.5888], [33.0351,-114.5750], [33.0328,-114.5174], [32.9718,-114.4913], [32.9764,-114.4775],
            [32.9372,-114.4844], [32.8427,-114.4679], [32.8161,-114.5091], [32.7850,-114.5311], [32.7573,-114.5284], [32.7503,-114.5641], [32.7353,-114.6162], 
            [32.7480,-114.6986], [32.7191,-114.7220], [32.6868,-115.1944], [32.5121,-117.3395], [32.7838,-117.4823], [33.0501,-117.5977], [33.2341,-117.6814], 
            [33.4578,-118.0591], [33.5403,-118.6290], [33.7928,-118.7073], [33.9582,-119.3706], [34.1925,-120.0050], [34.2561,-120.7164], [34.5360,-120.9128], 
            [34.9749,-120.8427], [35.2131,-121.1325], [35.5255,-121.3220], [35.9691,-121.8013], [36.2808,-122.1446], [36.7268,-122.1721], [37.2227,-122.6871],  
            [37.7783,-122.8903], [37.8965,-123.2378], [38.3449,-123.3202], [38.7423,-123.8338], [38.9946,-123.9793], [39.3088,-124.0329], [39.7642,-124.0823],
            [40.1663,-124.5314], [40.4658,-124.6509], [41.0110,-124.3144], [41.2386,-124.3419], [41.7170,-124.4545], [41.9983,-124.4009]];




        // var region_0 = L.polygon(d3.polygonHull(r1), {
        //     //color:get_region_color(averages,avg_max,avg_min,cnt,averages[0]), 
        //     opacity: 0, 
        //   //  fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[0]),
        //  // fillColor: "radialGradient(0.5,0.5,90%,50%,50%,color:get_region_color(averages,avg_max,avg_min,cnt,averages[0],get_region_color(averages,avg_max,avg_min,cnt,averages[0])",
        //     fillOpacity:0.7}).addTo(map);

       // var region_1 =null,region_2 =null,region_3 =null,region_4 =null,region_5 =null,region_6 =null,region_7 =null,region_8 =null,region_9 =null,region_10 =null;
       
       if (california) {
            california.remove();
        }

        if (region_1) {
            region_1.remove();
        }
        
        if (region_2) {
            region_2.remove();
        }
        
        if (region_3) {
            region_3.remove();
        }
        
        if (region_4) {
            region_4.remove();
        }
        
        if (region_5) {
            region_5.remove();
        }
        
        if (region_6) {
            region_6.remove();
        }
        
        if (region_7) {
            region_7.remove();
        }
        
        if (region_8) {
            region_8.remove();
        }
        
        if (region_9) {
            region_9.remove();
        }
        
        if (region_10) {
            region_10.remove();
        }        
        if (region_11) {
            region_11.remove();
        }        
        if (region_12) {
            region_12.remove();
        }        
        if (region_13) {
            region_13.remove();
        }        
        if (region_14) {
            region_14.remove();
        }        
        if (region_15) {
            region_15.remove();
        }
        if (region_16) {
            region_16.remove();
        }
        if (region_17) {
            region_17.remove();
        }
        if (region_18) {
            region_18.remove();
        }
        if (region_19) {
            region_19.remove();
        }
        if (region_20) {
            region_20.remove();
        }    

        if (region_21) {
            region_21.remove();
        }        
        if (region_22) {
            region_22.remove();
        }        
        if (region_23) {
            region_23.remove();
        }        
        if (region_24) {
            region_24.remove();
        }        
        if (region_25) {
            region_25.remove();
        }        
        if (region_26) {
            region_26.remove();
        }
        if (region_27) {
            region_27.remove();
        }
        if (region_28) {
            region_28.remove();
        }
        if (region_29) {
            region_29.remove();
        }
        if (region_30) {
            region_30.remove();
        }



       
        california = L.polygon(californiaboundary, {color:"#000", opacity: 0.9,fillColor:"#000",fillOpacity:0.01}).addTo(map);
        region_1 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r1)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[0]), opacity: 0,fillColor:get_region_color(averages,avg_max,avg_min,cnt,averages[0]),fillOpacity:0.7}).addTo(map);
        region_2 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r2)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[1]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[1]),fillOpacity:0.7}).addTo(map);
        region_3 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r3)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[2]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[2]),fillOpacity:0.7}).addTo(map);
        region_4 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r4)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[3]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[3]),fillOpacity:0.7}).addTo(map);
        region_5 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r5)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[4]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[4]),fillOpacity:0.7}).addTo(map);
        region_6 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r6)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[5]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[5]),fillOpacity:0.7}).addTo(map);
        region_7 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r7)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[6]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[6]),fillOpacity:0.7}).addTo(map);
        region_8 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r8)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[7]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[7]),fillOpacity:0.7}).addTo(map);
        region_9 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r9)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[8]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[8]),fillOpacity:0.7}).addTo(map);  
        region_10 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r10)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[9]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[9]),fillOpacity:0.7}).addTo(map);      
        region_11 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r11)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[10]), opacity: 0,fillColor:get_region_color(averages,avg_max,avg_min,cnt,averages[10]),fillOpacity:0.7}).addTo(map);
        region_12 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r12)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[11]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[11]),fillOpacity:0.7}).addTo(map);
        region_13 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r13)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[12]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[12]),fillOpacity:0.7}).addTo(map);
        region_14 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r14)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[13]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[13]),fillOpacity:0.7}).addTo(map);
        region_15 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r15)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[14]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[14]),fillOpacity:0.7}).addTo(map);
        region_16 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r16)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[15]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[15]),fillOpacity:0.7}).addTo(map);
        region_17 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r17)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[16]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[16]),fillOpacity:0.7}).addTo(map);
        region_18 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r18)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[17]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[17]),fillOpacity:0.7}).addTo(map);
        region_19 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r19)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[18]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[18]),fillOpacity:0.7}).addTo(map);  
        region_20 = L.polygon(polygonClipping.intersection([californiaboundary],[d3.polygonHull(r20)]), {color:get_region_color(averages,avg_max,avg_min,cnt,averages[19]), opacity: 0,fillColor: get_region_color(averages,avg_max,avg_min,cnt,averages[19]),fillOpacity:0.7}).addTo(map);  
       
        region_1.bindTooltip(averages[0].toString()).openTooltip();
        region_2.bindTooltip(averages[1].toString()).openTooltip();
        region_3.bindTooltip(averages[2].toString()).openTooltip();
        region_4.bindTooltip(averages[3].toString()).openTooltip();
        region_5.bindTooltip(averages[4].toString()).openTooltip();
        region_6.bindTooltip(averages[5].toString()).openTooltip();
        region_7.bindTooltip(averages[6].toString()).openTooltip();
        region_8.bindTooltip(averages[7].toString()).openTooltip();
        region_9.bindTooltip(averages[8].toString()).openTooltip();
        region_10.bindTooltip(averages[9].toString()).openTooltip();
        region_11.bindTooltip(averages[10].toString()).openTooltip();
        region_12.bindTooltip(averages[11].toString()).openTooltip();
        region_13.bindTooltip(averages[12].toString()).openTooltip();
        region_14.bindTooltip(averages[13].toString()).openTooltip();
        region_15.bindTooltip(averages[14].toString()).openTooltip();
        region_16.bindTooltip(averages[15].toString()).openTooltip();
        region_17.bindTooltip(averages[16].toString()).openTooltip();
        region_18.bindTooltip(averages[17].toString()).openTooltip();
        region_19.bindTooltip(averages[18].toString()).openTooltip();
        region_20.bindTooltip(averages[19].toString()).openTooltip();
          
    });
    }    
}

</script>

</body>
</html>
